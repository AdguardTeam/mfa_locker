# AW-2175 Research: Add Scrollbars to Application Screens

## Summary

This document captures the technical research for implementing scrollbar integration across the MFA Demo application screens.

## Existing Endpoints and Contracts

### Current Scrollable Widgets

The application contains **6 scrollable widgets** (excluding third-party package examples) that are candidates for scrollbar integration:

| File | Widget | Scrollable Type | Current ScrollController |
|------|--------|-----------------|-------------------------|
| `entries_list_view.dart:17` | `EntriesListView` | `ListView.builder` | None (auto-created) |
| `settings_screen.dart:64` | Settings ListView | `ListView` | None (auto-created) |
| `authentication_bottom_sheet_content.dart:52` | Auth dialog | `SingleChildScrollView` | None |
| `entry_value_dialog.dart:36` | Entry value display | `SingleChildScrollView` | None |
| `timeout_picker_dialog.dart:19` | Timeout options | `SingleChildScrollView` | None |
| `unlocked_screen.dart:75` | Uses `EntriesListView` | (delegates) | (delegates) |

### Widget Locations

```
example/lib/features/
├── locker/views/
│   ├── storage/
│   │   └── unlocked_screen.dart          # Uses EntriesListView
│   └── widgets/
│       ├── entries_list_view.dart        # ListView.builder for entries
│       ├── authentication_bottom_sheet_content.dart  # Auth dialog
│       ├── entry_value_dialog.dart       # Entry value display
│       └── timeout_picker_dialog.dart    # Timeout picker
└── settings/views/
    └── settings_screen.dart              # Settings ListView
```

## Layers and Dependencies

### Widget Dependency Flow

```
UnlockedScreen
    └── EntriesListView (ListView.builder)

SettingsScreen
    └── _SettingsView (StatefulWidget)
        └── ListView (inline)

TimeoutPickerDialog
    └── SingleChildScrollView → Column → ListTiles

EntryValueDialog
    └── SingleChildScrollView → SelectableText

AuthenticationBottomSheetContent
    └── SingleChildScrollView → Column (form elements)
```

### Import Dependencies

All affected widgets use standard Flutter imports:
- `package:flutter/material.dart` - Contains `Scrollbar`, `ScrollController`, `ListView`, `SingleChildScrollView`

No additional dependencies are required for scrollbar implementation.

## Patterns Used

### Current Scrolling Patterns

1. **Implicit ScrollController (ListView/ListView.builder)**:
   - `EntriesListView` and `SettingsScreen` use ListView without explicit controllers
   - Flutter creates PrimaryScrollController automatically

2. **No ScrollController (SingleChildScrollView)**:
   - `AuthenticationBottomSheetContent`, `EntryValueDialog`, `TimeoutPickerDialog`
   - These will require explicit controllers when adding Scrollbar wrapper

### Flutter 2.2+ Default Behavior

**Important Discovery**: Since Flutter 2.2 (and definitely in Flutter 3.35.1 used by this project), `ScrollBehavior` automatically applies scrollbars on desktop platforms (macOS, Windows, Linux). This means:

- Desktop: Scrollbars appear automatically via `MaterialScrollBehavior`
- Mobile (iOS/Android): No automatic scrollbars (platform convention)

### Existing Widget Patterns in Codebase

1. **StatelessWidget pattern** (`EntriesListView`, `EntryValueDialog`):
   ```dart
   @override
   Widget build(BuildContext context) => ListView.builder(...);
   ```

2. **StatefulWidget pattern** (`AuthenticationBottomSheetContent`, `_SettingsView`):
   ```dart
   @override
   Widget build(BuildContext context) => SingleChildScrollView(...);
   ```

3. **Dialog function pattern** (`TimeoutPickerDialog`):
   ```dart
   Future<Duration?> showTimeoutPickerDialog(...) {
     return showDialog<Duration>(
       builder: (context) => StatefulBuilder(
         builder: (context, setState) => AlertDialog(
           content: SingleChildScrollView(...),
         ),
       ),
     );
   }
   ```

## Limitations and Risks

### Confirmed Limitations

| Risk | Assessment | Impact | Mitigation |
|------|------------|--------|------------|
| **Flutter auto-scrollbars already active on desktop** | HIGH LIKELIHOOD | Changes may be unnecessary | Verify current behavior before implementation |
| **SingleChildScrollView requires explicit controller for Scrollbar** | CONFIRMED | Medium | Add ScrollController to StatefulWidgets |
| **Scrollbar overlapping dialog content** | LOW | Low | Test dialog layouts after changes |
| **StatelessWidget cannot hold ScrollController** | CONFIRMED | Medium | Convert to StatefulWidget or use constructor parameter |

### Implementation Constraints

1. **StatelessWidget Limitation**: `EntriesListView` and `EntryValueDialog` are StatelessWidgets and cannot hold a `ScrollController` as a field. Options:
   - Convert to StatefulWidget (more code)
   - Accept controller as constructor parameter (cleaner)
   - For ListView.builder, Scrollbar can share the auto-created controller via `primary: true`

2. **Dialog StatefulBuilder Pattern**: `TimeoutPickerDialog` uses `StatefulBuilder` inside `showDialog`. Adding a controller requires either:
   - Moving state management to a proper StatefulWidget
   - Using a hook pattern

3. **ConstrainedBox in dialogs**: `EntryValueDialog` and `TimeoutPickerDialog` use `ConstrainedBox` with `maxHeight`, which correctly limits scrollable area.

## Open Technical Questions

### Resolved Questions

1. **Q: Are scrollbars already showing on desktop?**
   - A: Since Flutter 2.2+, yes. `MaterialScrollBehavior` applies scrollbars automatically on desktop.
   - Action: Verify current behavior before making changes.

2. **Q: Do we need explicit ScrollController for ListView.builder?**
   - A: No, if using `Scrollbar` with `primary: true` or if relying on auto-scrollbars.

3. **Q: What about mobile platforms?**
   - A: Mobile platforms (iOS/Android) do not show scrollbars by default, which matches platform conventions.

### Questions to Verify During Implementation

1. **Behavior verification**: Run the app on macOS/Windows to confirm auto-scrollbar behavior is working as expected.

2. **Bottom sheet scrollbar visibility**: Does `SingleChildScrollView` inside `showModalBottomSheet` get auto-scrollbars? This may need explicit wrapping.

3. **Dialog scrollbar visibility**: Does `SingleChildScrollView` inside `AlertDialog.content` receive auto-scrollbars? May need explicit `Scrollbar` wrapper.

### Implementation Recommendation

Based on research, the implementation approach should be:

1. **First**: Verify current desktop behavior without any code changes
2. **If auto-scrollbars work**: No changes needed for `ListView`/`ListView.builder`
3. **If dialogs lack scrollbars**: Add explicit `Scrollbar` wrapper with `ScrollController` for:
   - `AuthenticationBottomSheetContent`
   - `EntryValueDialog`
   - `TimeoutPickerDialog`

### Minimal Change Pattern

For `SingleChildScrollView` in StatefulWidgets:
```dart
class _MyWidgetState extends State<MyWidget> {
  final _scrollController = ScrollController();

  @override
  void dispose() {
    _scrollController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) => Scrollbar(
    controller: _scrollController,
    child: SingleChildScrollView(
      controller: _scrollController,
      child: ...
    ),
  );
}
```

For StatelessWidgets with `SingleChildScrollView`, convert to StatefulWidget or accept controller from parent.

## References

- [Flutter Scrollbar API](https://api.flutter.dev/flutter/material/Scrollbar-class.html)
- [Default Desktop Scrollbars Breaking Change](https://docs.flutter.dev/release/breaking-changes/default-desktop-scrollbars)
- Project conventions: `/docs/conventions.md`
- Project vision: `/docs/vision.md`
- PRD: `/docs/prd/AW-2175.prd.md`
