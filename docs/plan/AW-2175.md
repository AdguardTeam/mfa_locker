# AW-2175: Implementation Plan - Add Scrollbars to Application Screens

Status: PLAN_APPROVED

## Overview

Add explicit scrollbar support to scrollable screens in the MFA Demo application. While Flutter 2.2+ provides automatic scrollbars on desktop platforms via `MaterialScrollBehavior`, certain widgets (dialogs, bottom sheets) may not receive this behavior automatically. This plan ensures consistent scrollbar visibility across all scrollable content.

## Components

### Affected Widgets

| Component | File | Type | Current State |
|-----------|------|------|---------------|
| `EntriesListView` | `entries_list_view.dart` | StatelessWidget | `ListView.builder` - auto-scrollbar works |
| `_SettingsView` | `settings_screen.dart` | StatefulWidget | `ListView` - auto-scrollbar works |
| `AuthenticationBottomSheetContent` | `authentication_bottom_sheet_content.dart` | StatefulWidget | `SingleChildScrollView` - needs explicit Scrollbar |
| `EntryValueDialog` | `entry_value_dialog.dart` | StatelessWidget | `SingleChildScrollView` - needs explicit Scrollbar |
| `TimeoutPickerDialog` | `timeout_picker_dialog.dart` | Function | `SingleChildScrollView` - needs explicit Scrollbar |

### Implementation Categories

1. **No Changes Required** (Auto-scrollbar works):
   - `EntriesListView` - Uses `ListView.builder`, receives auto-scrollbar on desktop
   - `_SettingsView` - Uses `ListView`, receives auto-scrollbar on desktop

2. **Changes Required** (Dialog/BottomSheet with `SingleChildScrollView`):
   - `AuthenticationBottomSheetContent` - Wrap with `Scrollbar`, add `ScrollController`
   - `EntryValueDialog` - Convert to StatefulWidget, add `Scrollbar` + `ScrollController`
   - `TimeoutPickerDialog` - Convert to StatefulWidget pattern, add `Scrollbar` + `ScrollController`

## API Contract

No API changes. Internal widget modifications only.

### Pattern for SingleChildScrollView in StatefulWidget

```dart
class _MyWidgetState extends State<MyWidget> {
  final _scrollController = ScrollController();

  @override
  void dispose() {
    _scrollController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) => Scrollbar(
    controller: _scrollController,
    child: SingleChildScrollView(
      controller: _scrollController,
      child: ...
    ),
  );
}
```

### Pattern for StatelessWidget → StatefulWidget Conversion

For `EntryValueDialog`:
- Convert from `StatelessWidget` to `StatefulWidget`
- Add `ScrollController` field with proper disposal
- Wrap `SingleChildScrollView` with `Scrollbar`

For `TimeoutPickerDialog`:
- Extract dialog content to a separate `StatefulWidget` class
- Remove `StatefulBuilder` pattern in favor of proper `StatefulWidget`
- Add `ScrollController` with proper lifecycle management

## Data Flows

No data flow changes. This is a purely visual enhancement.

```
Before: SingleChildScrollView → Content
After:  Scrollbar → SingleChildScrollView → Content
        (both sharing ScrollController)
```

## Implementation Steps

### Step 1: AuthenticationBottomSheetContent (Low Risk)

**File**: `authentication_bottom_sheet_content.dart`

1. Add `ScrollController` field:
   ```dart
   final _scrollController = ScrollController();
   ```

2. Add disposal in `dispose()`:
   ```dart
   @override
   void dispose() {
     _scrollController.dispose();
     _passwordController.dispose();
     super.dispose();
   }
   ```

3. Wrap `SingleChildScrollView` with `Scrollbar`:
   ```dart
   @override
   Widget build(BuildContext context) => Scrollbar(
     controller: _scrollController,
     child: SingleChildScrollView(
       controller: _scrollController,
       child: Padding(...),
     ),
   );
   ```

### Step 2: EntryValueDialog (Medium Complexity)

**File**: `entry_value_dialog.dart`

1. Convert `StatelessWidget` to `StatefulWidget`:
   - Rename `EntryValueDialog` class to accept state pattern
   - Create `_EntryValueDialogState` class

2. Add `ScrollController` with disposal

3. Wrap `SingleChildScrollView` with `Scrollbar` in the `content` section

**Before**:
```dart
class EntryValueDialog extends StatelessWidget {
  ...
  @override
  Widget build(BuildContext context) => AlertDialog(
    content: ConstrainedBox(
      child: SingleChildScrollView(...),
    ),
  );
}
```

**After**:
```dart
class EntryValueDialog extends StatefulWidget {
  ...
}

class _EntryValueDialogState extends State<EntryValueDialog> {
  final _scrollController = ScrollController();

  @override
  void dispose() {
    _scrollController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) => AlertDialog(
    content: ConstrainedBox(
      child: Scrollbar(
        controller: _scrollController,
        child: SingleChildScrollView(
          controller: _scrollController,
          child: SelectableText(...),
        ),
      ),
    ),
  );
}
```

### Step 3: TimeoutPickerDialog (Medium Complexity)

**File**: `timeout_picker_dialog.dart`

1. Create a new `_TimeoutPickerDialogContent` StatefulWidget class
2. Move the dialog content from `StatefulBuilder` to the new widget
3. Add `ScrollController` with proper disposal
4. Wrap `SingleChildScrollView` with `Scrollbar`
5. Update `showTimeoutPickerDialog` function to use the new widget

**Current Pattern** (StatefulBuilder):
```dart
return showDialog<Duration>(
  builder: (context) => StatefulBuilder(
    builder: (context, setState) => AlertDialog(
      content: SingleChildScrollView(...),
    ),
  ),
);
```

**New Pattern** (StatefulWidget):
```dart
return showDialog<Duration>(
  builder: (context) => _TimeoutPickerDialogContent(
    currentSelection: currentSelection,
    options: options,
  ),
);

class _TimeoutPickerDialogContent extends StatefulWidget { ... }

class _TimeoutPickerDialogContentState extends State<_TimeoutPickerDialogContent> {
  final _scrollController = ScrollController();
  late Duration _selected;

  @override
  void initState() {
    super.initState();
    _selected = widget.currentSelection;
  }

  @override
  void dispose() {
    _scrollController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) => AlertDialog(
    content: ConstrainedBox(
      child: Scrollbar(
        controller: _scrollController,
        child: SingleChildScrollView(
          controller: _scrollController,
          child: Column(...),
        ),
      ),
    ),
  );
}
```

## Non-Functional Requirements (NFR)

| Requirement | Target | Validation |
|-------------|--------|------------|
| Desktop scrollbar visibility | Scrollbars visible when content overflows | Manual testing on macOS/Windows |
| Mobile platform behavior | Platform-default (auto-hiding) | Manual testing on iOS/Android |
| No visual regression | Existing layouts unchanged | Visual comparison |
| Memory management | ScrollControllers properly disposed | Code review + analyzer |
| Code consistency | Follow existing patterns | Code review |

## Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Scrollbar overlapping dialog content | Low | Medium | Test all affected dialogs visually |
| ScrollController not disposed | Low | Medium | Follow established dispose pattern, analyzer will catch |
| Breaking keyboard avoidance in bottom sheet | Low | High | Test with keyboard visible on mobile |
| Unnecessary changes to ListView widgets | Low | Low | Skip widgets that already have auto-scrollbar |

## Testing Plan

### Manual Testing Checklist

1. **Desktop (macOS/Windows)**:
   - [ ] `AuthenticationBottomSheetContent`: Scrollbar visible when keyboard pushes content
   - [ ] `EntryValueDialog`: Scrollbar visible when entry value exceeds 400px height
   - [ ] `TimeoutPickerDialog`: Scrollbar visible (if options exceed visible area)
   - [ ] `EntriesListView`: Scrollbar visible when entries exceed screen (no changes, verify auto-scrollbar)
   - [ ] `SettingsScreen`: Scrollbar visible when settings exceed screen (no changes, verify auto-scrollbar)

2. **Mobile (iOS/Android)**:
   - [ ] All scrollable areas respond to touch scrolling
   - [ ] Scrollbars auto-hide per platform convention
   - [ ] Keyboard avoidance works correctly in bottom sheets

### Automated Testing

No new unit tests required. This is a visual/UI enhancement with no logic changes.

## Open Questions

None. The implementation approach is straightforward based on Flutter's built-in `Scrollbar` widget and established patterns in the codebase.

## Dependencies

- No external package dependencies
- No changes to core library (`lib/`)
- Changes confined to example app (`example/lib/`)

## Estimated Scope

- Files modified: 3
- Files unchanged: 2 (EntriesListView, SettingsScreen)
- Lines of code changed: ~50-70 lines
- Complexity: Low to Medium
